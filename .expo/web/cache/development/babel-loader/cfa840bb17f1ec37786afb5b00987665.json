{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) {\n    to[j] = from[i];\n  }\n\n  return to;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = __importDefault(require(\"react\"));\n\nvar react_native_1 = require(\"react-native-web/dist/index\");\n\nvar react_native_gesture_handler_1 = require(\"react-native-gesture-handler\");\n\nvar react_native_reanimated_1 = __importDefault(require(\"react-native-reanimated\"));\n\nvar procs_1 = require(\"./procs\");\n\nvar AnimatedFlatList = react_native_reanimated_1.default.createAnimatedComponent(react_native_gesture_handler_1.FlatList);\nvar Value = react_native_reanimated_1.default.Value,\n    abs = react_native_reanimated_1.default.abs,\n    set = react_native_reanimated_1.default.set,\n    cond = react_native_reanimated_1.default.cond,\n    add = react_native_reanimated_1.default.add,\n    sub = react_native_reanimated_1.default.sub,\n    event = react_native_reanimated_1.default.event,\n    block = react_native_reanimated_1.default.block,\n    eq = react_native_reanimated_1.default.eq,\n    neq = react_native_reanimated_1.default.neq,\n    and = react_native_reanimated_1.default.and,\n    or = react_native_reanimated_1.default.or,\n    call = react_native_reanimated_1.default.call,\n    onChange = react_native_reanimated_1.default.onChange,\n    greaterThan = react_native_reanimated_1.default.greaterThan,\n    greaterOrEq = react_native_reanimated_1.default.greaterOrEq,\n    lessOrEq = react_native_reanimated_1.default.lessOrEq,\n    not = react_native_reanimated_1.default.not,\n    Clock = react_native_reanimated_1.default.Clock,\n    clockRunning = react_native_reanimated_1.default.clockRunning,\n    startClock = react_native_reanimated_1.default.startClock,\n    stopClock = react_native_reanimated_1.default.stopClock,\n    spring = react_native_reanimated_1.default.spring,\n    defined = react_native_reanimated_1.default.defined,\n    min = react_native_reanimated_1.default.min,\n    max = react_native_reanimated_1.default.max,\n    debug = react_native_reanimated_1.default.debug;\nvar scrollPositionTolerance = 2;\nvar defaultAnimationConfig = {\n  damping: 20,\n  mass: 0.2,\n  stiffness: 100,\n  overshootClamping: false,\n  restSpeedThreshold: 0.2,\n  restDisplacementThreshold: 0.2\n};\nvar defaultProps = {\n  autoscrollThreshold: 30,\n  autoscrollSpeed: 100,\n  animationConfig: defaultAnimationConfig,\n  scrollEnabled: true,\n  dragHitSlop: 0,\n  activationDistance: 0,\n  dragItemOverflow: false\n};\n\nfunction onNextFrame(callback) {\n  setTimeout(function () {\n    requestAnimationFrame(callback);\n  });\n}\n\nvar DraggableFlatList = function (_super) {\n  __extends(DraggableFlatList, _super);\n\n  function DraggableFlatList(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.state = {\n      activeKey: null,\n      hoverComponent: null\n    };\n    _this.containerRef = react_1.default.createRef();\n    _this.flatlistRef = react_1.default.createRef();\n    _this.panGestureHandlerRef = react_1.default.createRef();\n    _this.containerSize = new Value(0);\n    _this.touchInit = new Value(0);\n    _this.activationDistance = new Value(0);\n    _this.touchAbsolute = new Value(0);\n    _this.panGestureState = new Value(react_native_gesture_handler_1.State.UNDETERMINED);\n    _this.isPressedIn = {\n      native: new Value(0),\n      js: false\n    };\n    _this.hasMoved = new Value(0);\n    _this.disabled = new Value(0);\n    _this.activeIndex = new Value(-1);\n    _this.spacerIndex = new Value(-1);\n    _this.isHovering = greaterThan(_this.activeIndex, -1);\n    _this.activeCellSize = new Value(0);\n    _this.activeCellOffset = new Value(0);\n    _this.scrollOffset = new Value(0);\n    _this.scrollViewSize = new Value(0);\n    _this.isScrolledUp = lessOrEq(sub(_this.scrollOffset, scrollPositionTolerance), 0);\n    _this.isScrolledDown = greaterOrEq(add(_this.scrollOffset, _this.containerSize, scrollPositionTolerance), _this.scrollViewSize);\n    _this.touchCellOffset = sub(_this.touchInit, _this.activeCellOffset);\n    _this.hoverAnimUnconstrained = sub(sub(_this.touchAbsolute, _this.activationDistance), _this.touchCellOffset);\n    _this.hoverAnimConstrained = min(sub(_this.containerSize, _this.activeCellSize), max(0, _this.hoverAnimUnconstrained));\n    _this.hoverAnim = _this.props.dragItemOverflow ? _this.hoverAnimUnconstrained : _this.hoverAnimConstrained;\n    _this.hoverOffset = add(_this.hoverAnim, _this.scrollOffset);\n    _this.placeholderOffset = new Value(0);\n    _this.placeholderPos = sub(_this.placeholderOffset, _this.scrollOffset);\n    _this.hoverTo = new Value(0);\n    _this.hoverClock = new Clock();\n    _this.hoverAnimState = {\n      finished: new Value(0),\n      velocity: new Value(0),\n      position: new Value(0),\n      time: new Value(0)\n    };\n    _this.hoverAnimConfig = __assign(__assign(__assign({}, defaultAnimationConfig), _this.props.animationConfig), {\n      toValue: _this.hoverTo\n    });\n    _this.distToTopEdge = max(0, _this.hoverAnim);\n    _this.distToBottomEdge = max(0, sub(_this.containerSize, add(_this.hoverAnim, _this.activeCellSize)));\n    _this.cellAnim = new Map();\n    _this.cellData = new Map();\n    _this.cellRefs = new Map();\n    _this.moveEndParams = [_this.activeIndex, _this.spacerIndex];\n    _this.resetTouchedCell = [set(_this.touchAbsolute, _this.hoverAnimConfig.toValue), set(_this.touchInit, 0), set(_this.activeCellOffset, 0), set(_this.activationDistance, 0), set(_this.hoverAnimState.position, _this.hoverAnimConfig.toValue), set(_this.hoverAnimState.time, 0), set(_this.hoverAnimState.finished, 0), set(_this.hoverAnimState.velocity, 0), set(_this.hasMoved, 0)];\n    _this.keyToIndex = new Map();\n    _this.isAutoScrollInProgress = {\n      native: new Value(0),\n      js: false\n    };\n    _this.queue = [];\n\n    _this.dataKeysHaveChanged = function (a, b) {\n      var lengthHasChanged = a.length !== b.length;\n      if (lengthHasChanged) return true;\n      var aKeys = a.map(function (d, i) {\n        return _this.keyExtractor(d, i);\n      });\n      var bKeys = b.map(function (d, i) {\n        return _this.keyExtractor(d, i);\n      });\n      var sameKeys = aKeys.every(function (k) {\n        return bKeys.includes(k);\n      });\n      return !sameKeys;\n    };\n\n    _this.componentDidUpdate = function (prevProps, prevState) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var layoutInvalidationKeyHasChanged, dataHasChanged, index, cellData;\n\n        var _this = this;\n\n        return __generator(this, function (_a) {\n          layoutInvalidationKeyHasChanged = prevProps.layoutInvalidationKey !== this.props.layoutInvalidationKey;\n          dataHasChanged = prevProps.data !== this.props.data;\n\n          if (layoutInvalidationKeyHasChanged || dataHasChanged) {\n            this.props.data.forEach(function (item, index) {\n              var key = _this.keyExtractor(item, index);\n\n              _this.keyToIndex.set(key, index);\n            });\n            this.updateCellData(this.props.data);\n            onNextFrame(this.flushQueue);\n\n            if (layoutInvalidationKeyHasChanged || this.dataKeysHaveChanged(prevProps.data, this.props.data)) {\n              this.queue.push(function () {\n                return _this.measureAll(_this.props.data);\n              });\n            }\n          }\n\n          if (!prevState.activeKey && this.state.activeKey) {\n            index = this.keyToIndex.get(this.state.activeKey);\n\n            if (index !== undefined) {\n              this.spacerIndex.setValue(index);\n              this.activeIndex.setValue(index);\n              this.isPressedIn.native.setValue(1);\n            }\n\n            cellData = this.cellData.get(this.state.activeKey);\n\n            if (cellData) {\n              this.activeCellOffset.setValue(sub(cellData.offset, this.scrollOffset));\n              this.activeCellSize.setValue(cellData.measurements.size);\n            }\n          }\n\n          return [2];\n        });\n      });\n    };\n\n    _this.flushQueue = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          this.queue.forEach(function (fn) {\n            return fn();\n          });\n          this.queue = [];\n          return [2];\n        });\n      });\n    };\n\n    _this.resetHoverState = function () {\n      _this.activeIndex.setValue(-1);\n\n      _this.spacerIndex.setValue(-1);\n\n      _this.touchAbsolute.setValue(0);\n\n      _this.disabled.setValue(0);\n\n      if (_this.state.hoverComponent !== null || _this.state.activeKey !== null) {\n        _this.setState({\n          hoverComponent: null,\n          activeKey: null\n        });\n      }\n    };\n\n    _this.drag = function (hoverComponent, activeKey) {\n      if (_this.state.hoverComponent) {\n        if (_this.props.debug) console.log(\"## Can't set multiple active items\");\n      } else {\n        _this.isPressedIn.js = true;\n\n        _this.setState({\n          activeKey: activeKey,\n          hoverComponent: hoverComponent\n        }, function () {\n          var index = _this.keyToIndex.get(activeKey);\n\n          var onDragBegin = _this.props.onDragBegin;\n\n          if (index !== undefined && onDragBegin) {\n            onDragBegin(index);\n          }\n        });\n      }\n    };\n\n    _this.onRelease = function (_a) {\n      var index = _a[0];\n      var onRelease = _this.props.onRelease;\n      _this.isPressedIn.js = false;\n      onRelease && onRelease(index);\n    };\n\n    _this.onDragEnd = function (_a) {\n      var from = _a[0],\n          to = _a[1];\n      var onDragEnd = _this.props.onDragEnd;\n\n      if (onDragEnd) {\n        var data = _this.props.data;\n\n        var newData = __spreadArray([], data);\n\n        if (from !== to) {\n          newData.splice(from, 1);\n          newData.splice(to, 0, data[from]);\n        }\n\n        onDragEnd({\n          from: from,\n          to: to,\n          data: newData\n        });\n      }\n\n      var lo = Math.min(from, to) - 1;\n      var hi = Math.max(from, to) + 1;\n\n      var _loop_1 = function _loop_1(i) {\n        _this.queue.push(function () {\n          var item = _this.props.data[i];\n          if (!item) return;\n\n          var key = _this.keyExtractor(item, i);\n\n          return _this.measureCell(key);\n        });\n      };\n\n      for (var i = lo; i < hi; i++) {\n        _loop_1(i);\n      }\n\n      _this.resetHoverState();\n    };\n\n    _this.updateCellData = function (data) {\n      if (data === void 0) {\n        data = [];\n      }\n\n      return data.forEach(function (item, index) {\n        var key = _this.keyExtractor(item, index);\n\n        var cell = _this.cellData.get(key);\n\n        if (cell) cell.currentIndex.setValue(index);\n      });\n    };\n\n    _this.setCellData = function (key, index) {\n      var clock = new Clock();\n      var currentIndex = new Value(index);\n\n      var config = __assign(__assign({}, _this.hoverAnimConfig), {\n        toValue: new Value(0)\n      });\n\n      var state = {\n        position: new Value(0),\n        velocity: new Value(0),\n        time: new Value(0),\n        finished: new Value(0)\n      };\n\n      _this.cellAnim.set(key, {\n        clock: clock,\n        state: state,\n        config: config\n      });\n\n      var initialized = new Value(0);\n      var size = new Value(0);\n      var offset = new Value(0);\n      var isAfterActive = new Value(0);\n      var translate = new Value(0);\n      var runSrping = cond(clockRunning(clock), procs_1.springFill(clock, state, config));\n      var onHasMoved = startClock(clock);\n      var onChangeSpacerIndex = cond(clockRunning(clock), stopClock(clock));\n      var onFinished = stopClock(clock);\n      var prevTrans = new Value(0);\n      var prevSpacerIndex = new Value(-1);\n      var anim = procs_1.setupCell(currentIndex, initialized, size, offset, isAfterActive, translate, prevTrans, prevSpacerIndex, _this.activeIndex, _this.activeCellSize, _this.hoverOffset, _this.scrollOffset, _this.isHovering, _this.hoverTo, _this.hasMoved, _this.spacerIndex, config.toValue, state.position, state.time, state.finished, runSrping, onHasMoved, onChangeSpacerIndex, onFinished, _this.isPressedIn.native, _this.placeholderOffset);\n      var transform = _this.props.horizontal ? [{\n        translateX: anim\n      }] : [{\n        translateY: anim\n      }];\n      var style = {\n        transform: transform\n      };\n      var cellData = {\n        initialized: initialized,\n        currentIndex: currentIndex,\n        size: size,\n        offset: offset,\n        style: style,\n        onLayout: function onLayout() {\n          if (_this.state.activeKey !== key) _this.measureCell(key);\n        },\n        onUnmount: function onUnmount() {\n          return initialized.setValue(0);\n        },\n        measurements: {\n          size: 0,\n          offset: 0\n        }\n      };\n\n      _this.cellData.set(key, cellData);\n    };\n\n    _this.measureAll = function (data) {\n      data.forEach(function (d, i) {\n        var key = _this.keyExtractor(d, i);\n\n        _this.measureCell(key);\n      });\n    };\n\n    _this.measureCell = function (key) {\n      return new Promise(function (resolve) {\n        var horizontal = _this.props.horizontal;\n\n        var onSuccess = function onSuccess(x, y, w, h) {\n          var activeKey = _this.state.activeKey;\n          var isHovering = activeKey !== null;\n\n          var cellData = _this.cellData.get(key);\n\n          var thisKeyIndex = _this.keyToIndex.get(key);\n\n          var activeKeyIndex = activeKey ? _this.keyToIndex.get(activeKey) : undefined;\n          var baseOffset = horizontal ? x : y;\n          var extraOffset = 0;\n\n          if (thisKeyIndex !== undefined && activeKeyIndex !== undefined && activeKey) {\n            var isAfterActive = thisKeyIndex > activeKeyIndex;\n\n            var activeCellData = _this.cellData.get(activeKey);\n\n            if (isHovering && isAfterActive && activeCellData) {\n              extraOffset = activeCellData.measurements.size;\n            }\n          }\n\n          var size = horizontal ? w : h;\n          var offset = baseOffset + extraOffset;\n          if (_this.props.debug) console.log(\"measure key \" + key + \": width \" + w + \" height \" + h + \" x \" + x + \" y \" + y + \" size \" + size + \" offset \" + offset);\n\n          if (cellData) {\n            cellData.size.setValue(size);\n            cellData.offset.setValue(offset);\n            cellData.measurements.size = size;\n            cellData.measurements.offset = offset;\n          }\n\n          if (isHovering) _this.queue.push(function () {\n            return _this.measureCell(key);\n          });\n          resolve();\n        };\n\n        var onFail = function onFail() {\n          if (_this.props.debug) console.log(\"## measureLayout fail!\", key);\n        };\n\n        var ref = _this.cellRefs.get(key);\n\n        var viewNode = ref && ref.current && ref.current.getNode();\n        var flatListNode = _this.flatlistRef.current;\n\n        if (viewNode && flatListNode) {\n          var nodeHandle = react_native_1.findNodeHandle(flatListNode);\n          if (nodeHandle) viewNode.measureLayout(nodeHandle, onSuccess, onFail);\n        } else {\n          var reason = !ref ? \"no ref\" : !flatListNode ? \"no flatlist node\" : \"invalid ref\";\n          if (_this.props.debug) console.log(\"## can't measure \" + key + \" reason: \" + reason);\n\n          _this.queue.push(function () {\n            return _this.measureCell(key);\n          });\n\n          return resolve();\n        }\n      });\n    };\n\n    _this.keyExtractor = function (item, index) {\n      if (_this.props.keyExtractor) return _this.props.keyExtractor(item, index);else throw new Error(\"You must provide a keyExtractor to DraggableFlatList\");\n    };\n\n    _this.onContainerLayout = function () {\n      var horizontal = _this.props.horizontal;\n      var containerRef = _this.containerRef.current;\n\n      if (containerRef) {\n        containerRef.getNode().measure(function (_x, _y, w, h) {\n          _this.containerSize.setValue(horizontal ? w : h);\n        });\n      }\n    };\n\n    _this.onListContentSizeChange = function (w, h) {\n      _this.scrollViewSize.setValue(_this.props.horizontal ? w : h);\n\n      if (_this.props.onContentSizeChange) _this.props.onContentSizeChange(w, h);\n    };\n\n    _this.targetScrollOffset = new Value(0);\n\n    _this.onAutoscrollComplete = function (params) {\n      _this.isAutoScrollInProgress.js = false;\n      if (_this.resolveAutoscroll) _this.resolveAutoscroll(params);\n    };\n\n    _this.scrollToAsync = function (offset) {\n      return new Promise(function (resolve) {\n        var _a;\n\n        _this.resolveAutoscroll = resolve;\n\n        _this.targetScrollOffset.setValue(offset);\n\n        _this.isAutoScrollInProgress.native.setValue(1);\n\n        _this.isAutoScrollInProgress.js = true;\n        var flatlistRef = _this.flatlistRef.current;\n\n        if (flatlistRef) {\n          var flatlistNode = \"scrollToOffset\" in flatlistRef ? flatlistRef : \"getNode\" in flatlistRef ? flatlistRef.getNode() : null;\n          (_a = flatlistNode === null || flatlistNode === void 0 ? void 0 : flatlistNode.scrollToOffset) === null || _a === void 0 ? void 0 : _a.call(flatlistNode, {\n            offset: offset\n          });\n        }\n      });\n    };\n\n    _this.getScrollTargetOffset = function (distFromTop, distFromBottom, scrollOffset, isScrolledUp, isScrolledDown) {\n      if (_this.isAutoScrollInProgress.js) return -1;\n      var _a = _this.props,\n          autoscrollThreshold = _a.autoscrollThreshold,\n          autoscrollSpeed = _a.autoscrollSpeed;\n      var scrollUp = distFromTop < autoscrollThreshold;\n      var scrollDown = distFromBottom < autoscrollThreshold;\n      if (!(scrollUp || scrollDown) || scrollUp && isScrolledUp || scrollDown && isScrolledDown) return -1;\n      var distFromEdge = scrollUp ? distFromTop : distFromBottom;\n      var speedPct = 1 - distFromEdge / autoscrollThreshold;\n      var speed = react_native_1.Platform.OS === \"ios\" ? autoscrollSpeed : autoscrollSpeed / 10;\n      var offset = speedPct * speed;\n      var targetOffset = scrollUp ? Math.max(0, scrollOffset - offset) : scrollOffset + offset;\n      return targetOffset;\n    };\n\n    _this.autoscrollLooping = false;\n\n    _this.autoscroll = function (params) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var shouldScroll, curParams, distFromTop, distFromBottom, scrollOffset, isScrolledUp, isScrolledDown, targetOffset, scrollingUpAtTop, scrollingDownAtBottom;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (this.autoscrollLooping) {\n                return [2];\n              }\n\n              this.autoscrollLooping = true;\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1,, 6, 7]);\n\n              shouldScroll = true;\n              curParams = params;\n              _a.label = 2;\n\n            case 2:\n              if (!shouldScroll) return [3, 5];\n              distFromTop = curParams[0], distFromBottom = curParams[1], scrollOffset = curParams[2], isScrolledUp = curParams[3], isScrolledDown = curParams[4];\n              targetOffset = this.getScrollTargetOffset(distFromTop, distFromBottom, scrollOffset, !!isScrolledUp, !!isScrolledDown);\n              scrollingUpAtTop = !!(isScrolledUp && targetOffset <= scrollOffset);\n              scrollingDownAtBottom = !!(isScrolledDown && targetOffset >= scrollOffset);\n              shouldScroll = targetOffset >= 0 && this.isPressedIn.js && !scrollingUpAtTop && !scrollingDownAtBottom;\n              if (!shouldScroll) return [3, 4];\n              return [4, this.scrollToAsync(targetOffset)];\n\n            case 3:\n              curParams = _a.sent();\n              _a.label = 4;\n\n            case 4:\n              return [3, 2];\n\n            case 5:\n              return [3, 7];\n\n            case 6:\n              this.autoscrollLooping = false;\n              return [7];\n\n            case 7:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.isAtTopEdge = lessOrEq(_this.distToTopEdge, _this.props.autoscrollThreshold);\n    _this.isAtBottomEdge = lessOrEq(_this.distToBottomEdge, _this.props.autoscrollThreshold);\n    _this.isAtEdge = or(_this.isAtBottomEdge, _this.isAtTopEdge);\n    _this.autoscrollParams = [_this.distToTopEdge, _this.distToBottomEdge, _this.scrollOffset, _this.isScrolledUp, _this.isScrolledDown];\n    _this.checkAutoscroll = cond(and(_this.isAtEdge, not(and(_this.isAtTopEdge, _this.isScrolledUp)), not(and(_this.isAtBottomEdge, _this.isScrolledDown)), eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), not(_this.isAutoScrollInProgress.native)), call(_this.autoscrollParams, _this.autoscroll));\n    _this.onScroll = event([{\n      nativeEvent: function nativeEvent(_a) {\n        var contentOffset = _a.contentOffset;\n        return block([set(_this.scrollOffset, _this.props.horizontal ? contentOffset.x : contentOffset.y), cond(and(_this.isAutoScrollInProgress.native, or(lessOrEq(abs(sub(_this.targetScrollOffset, _this.scrollOffset)), scrollPositionTolerance), and(_this.isScrolledUp, lessOrEq(_this.targetScrollOffset, _this.scrollOffset)), and(_this.isScrolledDown, greaterOrEq(_this.targetScrollOffset, _this.scrollOffset)))), [set(_this.isAutoScrollInProgress.native, 0), call(_this.autoscrollParams, _this.onAutoscrollComplete)])]);\n      }\n    }]);\n    _this.onGestureRelease = [cond(_this.isHovering, [set(_this.disabled, 1), cond(defined(_this.hoverClock), [cond(clockRunning(_this.hoverClock), [stopClock(_this.hoverClock)]), set(_this.hoverAnimState.position, _this.hoverAnim), startClock(_this.hoverClock)]), [call([_this.activeIndex], _this.onRelease), cond(not(_this.hasMoved), call([_this.activeIndex], _this.resetHoverState))]], [call([_this.activeIndex], _this.resetHoverState), _this.resetTouchedCell])];\n    _this.onPanStateChange = event([{\n      nativeEvent: function nativeEvent(_a) {\n        var state = _a.state,\n            x = _a.x,\n            y = _a.y;\n        return cond(and(neq(state, _this.panGestureState), not(_this.disabled)), [cond(or(eq(state, react_native_gesture_handler_1.State.BEGAN), and(eq(state, react_native_gesture_handler_1.State.ACTIVE), neq(_this.panGestureState, react_native_gesture_handler_1.State.BEGAN))), [set(_this.touchAbsolute, _this.props.horizontal ? x : y), set(_this.touchInit, _this.touchAbsolute)]), cond(eq(state, react_native_gesture_handler_1.State.ACTIVE), [set(_this.activationDistance, sub(_this.props.horizontal ? x : y, _this.touchInit)), set(_this.touchAbsolute, _this.props.horizontal ? x : y)]), cond(neq(_this.panGestureState, state), set(_this.panGestureState, state)), cond(or(eq(state, react_native_gesture_handler_1.State.END), eq(state, react_native_gesture_handler_1.State.CANCELLED), eq(state, react_native_gesture_handler_1.State.FAILED)), _this.onGestureRelease)]);\n      }\n    }]);\n    _this.onPanGestureEvent = event([{\n      nativeEvent: function nativeEvent(_a) {\n        var x = _a.x,\n            y = _a.y;\n        return cond(and(_this.isHovering, eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), not(_this.disabled)), [cond(not(_this.hasMoved), set(_this.hasMoved, 1)), [set(_this.touchAbsolute, _this.props.horizontal ? x : y)]]);\n      }\n    }]);\n    _this.hoverComponentTranslate = cond(clockRunning(_this.hoverClock), _this.hoverAnimState.position, _this.hoverAnim);\n    _this.hoverComponentOpacity = and(_this.isHovering, neq(_this.panGestureState, react_native_gesture_handler_1.State.CANCELLED));\n\n    _this.renderHoverComponent = function () {\n      var _a;\n\n      var hoverComponent = _this.state.hoverComponent;\n      var horizontal = _this.props.horizontal;\n      return react_1.default.createElement(react_native_reanimated_1.default.View, {\n        style: [horizontal ? styles.hoverComponentHorizontal : styles.hoverComponentVertical, {\n          opacity: _this.hoverComponentOpacity,\n          transform: [(_a = {}, _a[\"translate\" + (horizontal ? \"X\" : \"Y\")] = _this.hoverComponentTranslate, _a)]\n        }]\n      }, hoverComponent);\n    };\n\n    _this.renderItem = function (_a) {\n      var item = _a.item,\n          index = _a.index;\n\n      var key = _this.keyExtractor(item, index);\n\n      if (index !== _this.keyToIndex.get(key)) _this.keyToIndex.set(key, index);\n      var renderItem = _this.props.renderItem;\n      if (!_this.cellData.get(key)) _this.setCellData(key, index);\n      var onUnmount = (_this.cellData.get(key) || {\n        onUnmount: function onUnmount() {\n          if (_this.props.debug) console.log(\"## error, no cellData\");\n        }\n      }).onUnmount;\n      return react_1.default.createElement(RowItem, {\n        extraData: _this.props.extraData,\n        itemKey: key,\n        keyToIndex: _this.keyToIndex,\n        renderItem: renderItem,\n        item: item,\n        drag: _this.drag,\n        onUnmount: onUnmount\n      });\n    };\n\n    _this.renderOnPlaceholderIndexChange = function () {\n      return react_1.default.createElement(react_native_reanimated_1.default.Code, {\n        dependencies: []\n      }, function () {\n        return block([onChange(_this.spacerIndex, call([_this.spacerIndex], function (_a) {\n          var spacerIndex = _a[0];\n          return _this.props.onPlaceholderIndexChange(spacerIndex);\n        }))]);\n      });\n    };\n\n    _this.renderPlaceholder = function () {\n      var _a, _b;\n\n      var _c = _this.props,\n          renderPlaceholder = _c.renderPlaceholder,\n          horizontal = _c.horizontal;\n      var activeKey = _this.state.activeKey;\n      if (!activeKey || !renderPlaceholder) return null;\n\n      var activeIndex = _this.keyToIndex.get(activeKey);\n\n      if (activeIndex === undefined) return null;\n      var activeItem = _this.props.data[activeIndex];\n      var translateKey = horizontal ? \"translateX\" : \"translateY\";\n      var sizeKey = horizontal ? \"width\" : \"height\";\n\n      var style = __assign(__assign({}, react_native_1.StyleSheet.absoluteFillObject), (_a = {}, _a[sizeKey] = _this.activeCellSize, _a.transform = [(_b = {}, _b[translateKey] = _this.placeholderPos, _b)], _a));\n\n      return react_1.default.createElement(react_native_reanimated_1.default.View, {\n        style: style\n      }, renderPlaceholder({\n        item: activeItem,\n        index: activeIndex\n      }));\n    };\n\n    _this.CellRendererComponent = function (cellProps) {\n      var item = cellProps.item,\n          index = cellProps.index,\n          children = cellProps.children,\n          onLayout = cellProps.onLayout;\n      var horizontal = _this.props.horizontal;\n      var activeKey = _this.state.activeKey;\n\n      var key = _this.keyExtractor(item, index);\n\n      if (!_this.cellData.get(key)) _this.setCellData(key, index);\n\n      var cellData = _this.cellData.get(key);\n\n      if (!cellData) return null;\n      var style = cellData.style,\n          onCellLayout = cellData.onLayout;\n\n      var ref = _this.cellRefs.get(key);\n\n      if (!ref) {\n        ref = react_1.default.createRef();\n\n        _this.cellRefs.set(key, ref);\n      }\n\n      var isActiveCell = activeKey === key;\n      return react_1.default.createElement(react_native_reanimated_1.default.View, {\n        onLayout: onLayout,\n        style: style\n      }, react_1.default.createElement(react_native_reanimated_1.default.View, {\n        pointerEvents: activeKey ? \"none\" : \"auto\",\n        style: {\n          flexDirection: horizontal ? \"row\" : \"column\"\n        }\n      }, react_1.default.createElement(react_native_reanimated_1.default.View, {\n        ref: ref,\n        onLayout: onCellLayout,\n        style: isActiveCell ? {\n          opacity: 0\n        } : undefined\n      }, children)));\n    };\n\n    _this.onContainerTouchEnd = function () {\n      _this.isPressedIn.native.setValue(0);\n    };\n\n    var data = props.data,\n        onRef = props.onRef;\n    data.forEach(function (item, index) {\n      var key = _this.keyExtractor(item, index);\n\n      _this.keyToIndex.set(key, index);\n    });\n    onRef && onRef(_this.flatlistRef);\n    return _this;\n  }\n\n  DraggableFlatList.getDerivedStateFromProps = function (props) {\n    return {\n      extraData: props.extraData\n    };\n  };\n\n  DraggableFlatList.prototype.renderDebug = function () {\n    var _this = this;\n\n    return react_1.default.createElement(react_native_reanimated_1.default.Code, {\n      dependencies: []\n    }, function () {\n      return block([onChange(_this.spacerIndex, debug(\"spacerIndex: \", _this.spacerIndex))]);\n    });\n  };\n\n  DraggableFlatList.prototype.render = function () {\n    var _this = this;\n\n    var _a = this.props,\n        dragHitSlop = _a.dragHitSlop,\n        scrollEnabled = _a.scrollEnabled,\n        horizontal = _a.horizontal,\n        activationDistance = _a.activationDistance,\n        onScrollOffsetChange = _a.onScrollOffsetChange,\n        renderPlaceholder = _a.renderPlaceholder,\n        onPlaceholderIndexChange = _a.onPlaceholderIndexChange,\n        containerStyle = _a.containerStyle,\n        simultaneousHandlers = _a.simultaneousHandlers;\n    var hoverComponent = this.state.hoverComponent;\n    var dynamicProps = {};\n\n    if (activationDistance) {\n      var activeOffset = [-activationDistance, activationDistance];\n      dynamicProps = horizontal ? {\n        activeOffsetX: activeOffset\n      } : {\n        activeOffsetY: activeOffset\n      };\n    }\n\n    return react_1.default.createElement(react_native_gesture_handler_1.PanGestureHandler, __assign({\n      ref: this.panGestureHandlerRef,\n      hitSlop: dragHitSlop,\n      onGestureEvent: this.onPanGestureEvent,\n      onHandlerStateChange: this.onPanStateChange,\n      simultaneousHandlers: simultaneousHandlers\n    }, dynamicProps), react_1.default.createElement(react_native_reanimated_1.default.View, {\n      style: [styles.flex, containerStyle],\n      ref: this.containerRef,\n      onLayout: this.onContainerLayout,\n      onTouchEnd: this.onContainerTouchEnd\n    }, !!onPlaceholderIndexChange && this.renderOnPlaceholderIndexChange(), !!renderPlaceholder && this.renderPlaceholder(), react_1.default.createElement(AnimatedFlatList, __assign({}, this.props, {\n      CellRendererComponent: this.CellRendererComponent,\n      ref: this.flatlistRef,\n      onContentSizeChange: this.onListContentSizeChange,\n      scrollEnabled: !hoverComponent && scrollEnabled,\n      renderItem: this.renderItem,\n      extraData: this.state,\n      keyExtractor: this.keyExtractor,\n      onScroll: this.onScroll,\n      scrollEventThrottle: 1,\n      simultaneousHandlers: simultaneousHandlers\n    })), !!hoverComponent && this.renderHoverComponent(), react_1.default.createElement(react_native_reanimated_1.default.Code, {\n      dependencies: []\n    }, function () {\n      return block([onChange(_this.isPressedIn.native, cond(not(_this.isPressedIn.native), _this.onGestureRelease)), onChange(_this.hoverComponentTranslate, _this.checkAutoscroll), cond(clockRunning(_this.hoverClock), [spring(_this.hoverClock, _this.hoverAnimState, _this.hoverAnimConfig), cond(eq(_this.hoverAnimState.finished, 1), [_this.resetTouchedCell, stopClock(_this.hoverClock), call(_this.moveEndParams, _this.onDragEnd), set(_this.hasMoved, 0)])])]);\n    }), onScrollOffsetChange && react_1.default.createElement(react_native_reanimated_1.default.Code, {\n      dependencies: []\n    }, function () {\n      return onChange(_this.scrollOffset, call([_this.scrollOffset], function (_a) {\n        var offset = _a[0];\n        return onScrollOffsetChange(offset);\n      }));\n    }), !!this.props.debug && this.renderDebug()));\n  };\n\n  DraggableFlatList.defaultProps = defaultProps;\n  return DraggableFlatList;\n}(react_1.default.Component);\n\nexports.default = DraggableFlatList;\n\nvar RowItem = function (_super) {\n  __extends(RowItem, _super);\n\n  function RowItem() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.drag = function () {\n      var _a = _this.props,\n          drag = _a.drag,\n          renderItem = _a.renderItem,\n          item = _a.item,\n          keyToIndex = _a.keyToIndex,\n          itemKey = _a.itemKey,\n          debug = _a.debug;\n      var hoverComponent = renderItem({\n        isActive: true,\n        item: item,\n        index: keyToIndex.get(itemKey),\n        drag: function drag() {\n          if (debug) console.log(\"## attempt to call drag() on hovering component\");\n        }\n      });\n      drag(hoverComponent, itemKey);\n    };\n\n    return _this;\n  }\n\n  RowItem.prototype.componentWillUnmount = function () {\n    this.props.onUnmount();\n  };\n\n  RowItem.prototype.render = function () {\n    var _a = this.props,\n        renderItem = _a.renderItem,\n        item = _a.item,\n        keyToIndex = _a.keyToIndex,\n        itemKey = _a.itemKey;\n    return renderItem({\n      isActive: false,\n      item: item,\n      index: keyToIndex.get(itemKey),\n      drag: this.drag\n    });\n  };\n\n  return RowItem;\n}(react_1.default.PureComponent);\n\nvar styles = react_native_1.StyleSheet.create({\n  flex: {\n    flex: 1\n  },\n  hoverComponentVertical: {\n    position: \"absolute\",\n    left: 0,\n    right: 0\n  },\n  hoverComponentHorizontal: {\n    position: \"absolute\",\n    bottom: 0,\n    top: 0\n  }\n});","map":{"version":3,"sources":["/home/rumble/dev/my/fitness-cycle/node_modules/react-native-draggable-flatlist/lib/index.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","pop","push","__spreadArray","to","from","il","j","__importDefault","mod","__esModule","defineProperty","exports","react_1","require","react_native_gesture_handler_1","react_native_reanimated_1","procs_1","AnimatedFlatList","default","createAnimatedComponent","FlatList","Value","abs","set","cond","add","sub","event","block","eq","neq","and","or","onChange","greaterThan","greaterOrEq","lessOrEq","not","Clock","clockRunning","startClock","stopClock","spring","defined","min","max","debug","scrollPositionTolerance","defaultAnimationConfig","damping","mass","stiffness","overshootClamping","restSpeedThreshold","restDisplacementThreshold","defaultProps","autoscrollThreshold","autoscrollSpeed","animationConfig","scrollEnabled","dragHitSlop","activationDistance","dragItemOverflow","onNextFrame","callback","setTimeout","requestAnimationFrame","DraggableFlatList","_super","props","_this","state","activeKey","hoverComponent","containerRef","createRef","flatlistRef","panGestureHandlerRef","containerSize","touchInit","touchAbsolute","panGestureState","State","UNDETERMINED","isPressedIn","native","js","hasMoved","disabled","activeIndex","spacerIndex","isHovering","activeCellSize","activeCellOffset","scrollOffset","scrollViewSize","isScrolledUp","isScrolledDown","touchCellOffset","hoverAnimUnconstrained","hoverAnimConstrained","hoverAnim","hoverOffset","placeholderOffset","placeholderPos","hoverTo","hoverClock","hoverAnimState","finished","velocity","position","time","hoverAnimConfig","toValue","distToTopEdge","distToBottomEdge","cellAnim","Map","cellData","cellRefs","moveEndParams","resetTouchedCell","keyToIndex","isAutoScrollInProgress","queue","dataKeysHaveChanged","a","lengthHasChanged","aKeys","map","keyExtractor","bKeys","sameKeys","every","k","includes","componentDidUpdate","prevProps","prevState","layoutInvalidationKeyHasChanged","dataHasChanged","index","_a","layoutInvalidationKey","data","forEach","item","key","updateCellData","flushQueue","measureAll","get","undefined","setValue","offset","measurements","size","fn","resetHoverState","setState","drag","console","log","onDragBegin","onRelease","onDragEnd","newData","splice","lo","Math","hi","_loop_1","measureCell","cell","currentIndex","setCellData","clock","config","initialized","isAfterActive","translate","runSrping","springFill","onHasMoved","onChangeSpacerIndex","onFinished","prevTrans","prevSpacerIndex","anim","setupCell","transform","horizontal","translateX","translateY","style","onLayout","onUnmount","onSuccess","x","w","h","thisKeyIndex","activeKeyIndex","baseOffset","extraOffset","activeCellData","onFail","ref","viewNode","current","getNode","flatListNode","nodeHandle","react_native_1","findNodeHandle","measureLayout","reason","Error","onContainerLayout","measure","_x","_y","onListContentSizeChange","onContentSizeChange","targetScrollOffset","onAutoscrollComplete","params","resolveAutoscroll","scrollToAsync","flatlistNode","scrollToOffset","getScrollTargetOffset","distFromTop","distFromBottom","scrollUp","scrollDown","distFromEdge","speedPct","speed","Platform","OS","targetOffset","autoscrollLooping","autoscroll","shouldScroll","curParams","scrollingUpAtTop","scrollingDownAtBottom","isAtTopEdge","isAtBottomEdge","isAtEdge","autoscrollParams","checkAutoscroll","ACTIVE","onScroll","nativeEvent","contentOffset","onGestureRelease","onPanStateChange","BEGAN","END","CANCELLED","FAILED","onPanGestureEvent","hoverComponentTranslate","hoverComponentOpacity","renderHoverComponent","createElement","View","styles","hoverComponentHorizontal","hoverComponentVertical","opacity","renderItem","RowItem","extraData","itemKey","renderOnPlaceholderIndexChange","Code","dependencies","onPlaceholderIndexChange","renderPlaceholder","_b","_c","activeItem","translateKey","sizeKey","StyleSheet","absoluteFillObject","CellRendererComponent","cellProps","children","onCellLayout","isActiveCell","pointerEvents","flexDirection","onContainerTouchEnd","onRef","getDerivedStateFromProps","renderDebug","render","onScrollOffsetChange","containerStyle","simultaneousHandlers","dynamicProps","activeOffset","activeOffsetX","activeOffsetY","PanGestureHandler","hitSlop","onGestureEvent","onHandlerStateChange","flex","onTouchEnd","scrollEventThrottle","Component","isActive","componentWillUnmount","PureComponent","left","right","bottom","top"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = __importDefault(require(\"react\"));\nvar react_native_1 = require(\"react-native\");\nvar react_native_gesture_handler_1 = require(\"react-native-gesture-handler\");\nvar react_native_reanimated_1 = __importDefault(require(\"react-native-reanimated\"));\nvar procs_1 = require(\"./procs\");\nvar AnimatedFlatList = react_native_reanimated_1.default.createAnimatedComponent(react_native_gesture_handler_1.FlatList);\nvar Value = react_native_reanimated_1.default.Value, abs = react_native_reanimated_1.default.abs, set = react_native_reanimated_1.default.set, cond = react_native_reanimated_1.default.cond, add = react_native_reanimated_1.default.add, sub = react_native_reanimated_1.default.sub, event = react_native_reanimated_1.default.event, block = react_native_reanimated_1.default.block, eq = react_native_reanimated_1.default.eq, neq = react_native_reanimated_1.default.neq, and = react_native_reanimated_1.default.and, or = react_native_reanimated_1.default.or, call = react_native_reanimated_1.default.call, onChange = react_native_reanimated_1.default.onChange, greaterThan = react_native_reanimated_1.default.greaterThan, greaterOrEq = react_native_reanimated_1.default.greaterOrEq, lessOrEq = react_native_reanimated_1.default.lessOrEq, not = react_native_reanimated_1.default.not, Clock = react_native_reanimated_1.default.Clock, clockRunning = react_native_reanimated_1.default.clockRunning, startClock = react_native_reanimated_1.default.startClock, stopClock = react_native_reanimated_1.default.stopClock, spring = react_native_reanimated_1.default.spring, defined = react_native_reanimated_1.default.defined, min = react_native_reanimated_1.default.min, max = react_native_reanimated_1.default.max, debug = react_native_reanimated_1.default.debug;\n// Fire onScrollComplete when within this many\n// px of target offset\nvar scrollPositionTolerance = 2;\nvar defaultAnimationConfig = {\n    damping: 20,\n    mass: 0.2,\n    stiffness: 100,\n    overshootClamping: false,\n    restSpeedThreshold: 0.2,\n    restDisplacementThreshold: 0.2,\n};\nvar defaultProps = {\n    autoscrollThreshold: 30,\n    autoscrollSpeed: 100,\n    animationConfig: defaultAnimationConfig,\n    scrollEnabled: true,\n    dragHitSlop: 0,\n    activationDistance: 0,\n    dragItemOverflow: false,\n};\n// Run callback on next paint:\n// https://stackoverflow.com/questions/26556436/react-after-render-code\nfunction onNextFrame(callback) {\n    setTimeout(function () {\n        requestAnimationFrame(callback);\n    });\n}\nvar DraggableFlatList = /** @class */ (function (_super) {\n    __extends(DraggableFlatList, _super);\n    function DraggableFlatList(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            activeKey: null,\n            hoverComponent: null,\n        };\n        _this.containerRef = react_1.default.createRef();\n        _this.flatlistRef = react_1.default.createRef();\n        _this.panGestureHandlerRef = react_1.default.createRef();\n        _this.containerSize = new Value(0);\n        _this.touchInit = new Value(0); // Position of initial touch\n        _this.activationDistance = new Value(0); // Distance finger travels from initial touch to when dragging begins\n        _this.touchAbsolute = new Value(0); // Finger position on screen, relative to container\n        _this.panGestureState = new Value(react_native_gesture_handler_1.State.UNDETERMINED);\n        _this.isPressedIn = {\n            native: new Value(0),\n            js: false,\n        };\n        _this.hasMoved = new Value(0);\n        _this.disabled = new Value(0);\n        _this.activeIndex = new Value(-1); // Index of hovering cell\n        _this.spacerIndex = new Value(-1); // Index of hovered-over cell\n        _this.isHovering = greaterThan(_this.activeIndex, -1);\n        _this.activeCellSize = new Value(0); // Height or width of acctive cell\n        _this.activeCellOffset = new Value(0); // Distance between active cell and edge of container\n        _this.scrollOffset = new Value(0);\n        _this.scrollViewSize = new Value(0);\n        _this.isScrolledUp = lessOrEq(sub(_this.scrollOffset, scrollPositionTolerance), 0);\n        _this.isScrolledDown = greaterOrEq(add(_this.scrollOffset, _this.containerSize, scrollPositionTolerance), _this.scrollViewSize);\n        _this.touchCellOffset = sub(_this.touchInit, _this.activeCellOffset); // Distance between touch point and edge of cell\n        _this.hoverAnimUnconstrained = sub(sub(_this.touchAbsolute, _this.activationDistance), _this.touchCellOffset);\n        _this.hoverAnimConstrained = min(sub(_this.containerSize, _this.activeCellSize), max(0, _this.hoverAnimUnconstrained));\n        _this.hoverAnim = _this.props.dragItemOverflow\n            ? _this.hoverAnimUnconstrained\n            : _this.hoverAnimConstrained;\n        _this.hoverOffset = add(_this.hoverAnim, _this.scrollOffset);\n        _this.placeholderOffset = new Value(0);\n        _this.placeholderPos = sub(_this.placeholderOffset, _this.scrollOffset);\n        _this.hoverTo = new Value(0);\n        _this.hoverClock = new Clock();\n        _this.hoverAnimState = {\n            finished: new Value(0),\n            velocity: new Value(0),\n            position: new Value(0),\n            time: new Value(0),\n        };\n        _this.hoverAnimConfig = __assign(__assign(__assign({}, defaultAnimationConfig), _this.props.animationConfig), { toValue: _this.hoverTo });\n        _this.distToTopEdge = max(0, _this.hoverAnim);\n        _this.distToBottomEdge = max(0, sub(_this.containerSize, add(_this.hoverAnim, _this.activeCellSize)));\n        _this.cellAnim = new Map();\n        _this.cellData = new Map();\n        _this.cellRefs = new Map();\n        _this.moveEndParams = [_this.activeIndex, _this.spacerIndex];\n        // Note: this could use a refactor as it combines touch state + cell animation\n        _this.resetTouchedCell = [\n            set(_this.touchAbsolute, _this.hoverAnimConfig.toValue),\n            set(_this.touchInit, 0),\n            set(_this.activeCellOffset, 0),\n            set(_this.activationDistance, 0),\n            set(_this.hoverAnimState.position, _this.hoverAnimConfig.toValue),\n            set(_this.hoverAnimState.time, 0),\n            set(_this.hoverAnimState.finished, 0),\n            set(_this.hoverAnimState.velocity, 0),\n            set(_this.hasMoved, 0),\n        ];\n        _this.keyToIndex = new Map();\n        _this.isAutoScrollInProgress = {\n            native: new Value(0),\n            js: false,\n        };\n        _this.queue = [];\n        _this.dataKeysHaveChanged = function (a, b) {\n            var lengthHasChanged = a.length !== b.length;\n            if (lengthHasChanged)\n                return true;\n            var aKeys = a.map(function (d, i) { return _this.keyExtractor(d, i); });\n            var bKeys = b.map(function (d, i) { return _this.keyExtractor(d, i); });\n            var sameKeys = aKeys.every(function (k) { return bKeys.includes(k); });\n            return !sameKeys;\n        };\n        _this.componentDidUpdate = function (prevProps, prevState) { return __awaiter(_this, void 0, void 0, function () {\n            var layoutInvalidationKeyHasChanged, dataHasChanged, index, cellData;\n            var _this = this;\n            return __generator(this, function (_a) {\n                layoutInvalidationKeyHasChanged = prevProps.layoutInvalidationKey !== this.props.layoutInvalidationKey;\n                dataHasChanged = prevProps.data !== this.props.data;\n                if (layoutInvalidationKeyHasChanged || dataHasChanged) {\n                    this.props.data.forEach(function (item, index) {\n                        var key = _this.keyExtractor(item, index);\n                        _this.keyToIndex.set(key, index);\n                    });\n                    // Remeasure on next paint\n                    this.updateCellData(this.props.data);\n                    onNextFrame(this.flushQueue);\n                    if (layoutInvalidationKeyHasChanged ||\n                        this.dataKeysHaveChanged(prevProps.data, this.props.data)) {\n                        this.queue.push(function () { return _this.measureAll(_this.props.data); });\n                    }\n                }\n                if (!prevState.activeKey && this.state.activeKey) {\n                    index = this.keyToIndex.get(this.state.activeKey);\n                    if (index !== undefined) {\n                        this.spacerIndex.setValue(index);\n                        this.activeIndex.setValue(index);\n                        this.isPressedIn.native.setValue(1);\n                    }\n                    cellData = this.cellData.get(this.state.activeKey);\n                    if (cellData) {\n                        this.activeCellOffset.setValue(sub(cellData.offset, this.scrollOffset));\n                        this.activeCellSize.setValue(cellData.measurements.size);\n                    }\n                }\n                return [2 /*return*/];\n            });\n        }); };\n        _this.flushQueue = function () { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this.queue.forEach(function (fn) { return fn(); });\n                this.queue = [];\n                return [2 /*return*/];\n            });\n        }); };\n        _this.resetHoverState = function () {\n            _this.activeIndex.setValue(-1);\n            _this.spacerIndex.setValue(-1);\n            _this.touchAbsolute.setValue(0);\n            _this.disabled.setValue(0);\n            if (_this.state.hoverComponent !== null || _this.state.activeKey !== null) {\n                _this.setState({\n                    hoverComponent: null,\n                    activeKey: null,\n                });\n            }\n        };\n        _this.drag = function (hoverComponent, activeKey) {\n            if (_this.state.hoverComponent) {\n                // We can't drag more than one row at a time\n                // TODO: Put action on queue?\n                if (_this.props.debug)\n                    console.log(\"## Can't set multiple active items\");\n            }\n            else {\n                _this.isPressedIn.js = true;\n                _this.setState({\n                    activeKey: activeKey,\n                    hoverComponent: hoverComponent,\n                }, function () {\n                    var index = _this.keyToIndex.get(activeKey);\n                    var onDragBegin = _this.props.onDragBegin;\n                    if (index !== undefined && onDragBegin) {\n                        onDragBegin(index);\n                    }\n                });\n            }\n        };\n        _this.onRelease = function (_a) {\n            var index = _a[0];\n            var onRelease = _this.props.onRelease;\n            _this.isPressedIn.js = false;\n            onRelease && onRelease(index);\n        };\n        _this.onDragEnd = function (_a) {\n            var from = _a[0], to = _a[1];\n            var onDragEnd = _this.props.onDragEnd;\n            if (onDragEnd) {\n                var data = _this.props.data;\n                var newData = __spreadArray([], data);\n                if (from !== to) {\n                    newData.splice(from, 1);\n                    newData.splice(to, 0, data[from]);\n                }\n                onDragEnd({ from: from, to: to, data: newData });\n            }\n            var lo = Math.min(from, to) - 1;\n            var hi = Math.max(from, to) + 1;\n            var _loop_1 = function (i) {\n                _this.queue.push(function () {\n                    var item = _this.props.data[i];\n                    if (!item)\n                        return;\n                    var key = _this.keyExtractor(item, i);\n                    return _this.measureCell(key);\n                });\n            };\n            for (var i = lo; i < hi; i++) {\n                _loop_1(i);\n            }\n            _this.resetHoverState();\n        };\n        _this.updateCellData = function (data) {\n            if (data === void 0) { data = []; }\n            return data.forEach(function (item, index) {\n                var key = _this.keyExtractor(item, index);\n                var cell = _this.cellData.get(key);\n                if (cell)\n                    cell.currentIndex.setValue(index);\n            });\n        };\n        _this.setCellData = function (key, index) {\n            var clock = new Clock();\n            var currentIndex = new Value(index);\n            var config = __assign(__assign({}, _this.hoverAnimConfig), { toValue: new Value(0) });\n            var state = {\n                position: new Value(0),\n                velocity: new Value(0),\n                time: new Value(0),\n                finished: new Value(0),\n            };\n            _this.cellAnim.set(key, { clock: clock, state: state, config: config });\n            var initialized = new Value(0);\n            var size = new Value(0);\n            var offset = new Value(0);\n            var isAfterActive = new Value(0);\n            var translate = new Value(0);\n            var runSrping = cond(clockRunning(clock), procs_1.springFill(clock, state, config));\n            var onHasMoved = startClock(clock);\n            var onChangeSpacerIndex = cond(clockRunning(clock), stopClock(clock));\n            var onFinished = stopClock(clock);\n            var prevTrans = new Value(0);\n            var prevSpacerIndex = new Value(-1);\n            var anim = procs_1.setupCell(currentIndex, initialized, size, offset, isAfterActive, translate, prevTrans, prevSpacerIndex, _this.activeIndex, _this.activeCellSize, _this.hoverOffset, _this.scrollOffset, _this.isHovering, _this.hoverTo, _this.hasMoved, _this.spacerIndex, config.toValue, state.position, state.time, state.finished, runSrping, onHasMoved, onChangeSpacerIndex, onFinished, _this.isPressedIn.native, _this.placeholderOffset);\n            var transform = _this.props.horizontal\n                ? [{ translateX: anim }]\n                : [{ translateY: anim }];\n            var style = {\n                transform: transform,\n            };\n            var cellData = {\n                initialized: initialized,\n                currentIndex: currentIndex,\n                size: size,\n                offset: offset,\n                style: style,\n                onLayout: function () {\n                    if (_this.state.activeKey !== key)\n                        _this.measureCell(key);\n                },\n                onUnmount: function () { return initialized.setValue(0); },\n                measurements: {\n                    size: 0,\n                    offset: 0,\n                },\n            };\n            _this.cellData.set(key, cellData);\n        };\n        _this.measureAll = function (data) {\n            data.forEach(function (d, i) {\n                var key = _this.keyExtractor(d, i);\n                _this.measureCell(key);\n            });\n        };\n        _this.measureCell = function (key) {\n            return new Promise(function (resolve) {\n                var horizontal = _this.props.horizontal;\n                var onSuccess = function (x, y, w, h) {\n                    var activeKey = _this.state.activeKey;\n                    var isHovering = activeKey !== null;\n                    var cellData = _this.cellData.get(key);\n                    var thisKeyIndex = _this.keyToIndex.get(key);\n                    var activeKeyIndex = activeKey\n                        ? _this.keyToIndex.get(activeKey)\n                        : undefined;\n                    var baseOffset = horizontal ? x : y;\n                    var extraOffset = 0;\n                    if (thisKeyIndex !== undefined &&\n                        activeKeyIndex !== undefined &&\n                        activeKey) {\n                        var isAfterActive = thisKeyIndex > activeKeyIndex;\n                        var activeCellData = _this.cellData.get(activeKey);\n                        if (isHovering && isAfterActive && activeCellData) {\n                            extraOffset = activeCellData.measurements.size;\n                        }\n                    }\n                    var size = horizontal ? w : h;\n                    var offset = baseOffset + extraOffset;\n                    if (_this.props.debug)\n                        console.log(\"measure key \" + key + \": width \" + w + \" height \" + h + \" x \" + x + \" y \" + y + \" size \" + size + \" offset \" + offset);\n                    if (cellData) {\n                        cellData.size.setValue(size);\n                        cellData.offset.setValue(offset);\n                        cellData.measurements.size = size;\n                        cellData.measurements.offset = offset;\n                    }\n                    // remeasure on next layout if hovering\n                    if (isHovering)\n                        _this.queue.push(function () { return _this.measureCell(key); });\n                    resolve();\n                };\n                var onFail = function () {\n                    if (_this.props.debug)\n                        console.log(\"## measureLayout fail!\", key);\n                };\n                var ref = _this.cellRefs.get(key);\n                var viewNode = ref && ref.current && ref.current.getNode();\n                var flatListNode = _this.flatlistRef.current;\n                if (viewNode && flatListNode) {\n                    // @ts-ignore\n                    var nodeHandle = react_native_1.findNodeHandle(flatListNode);\n                    if (nodeHandle)\n                        viewNode.measureLayout(nodeHandle, onSuccess, onFail);\n                }\n                else {\n                    var reason = !ref\n                        ? \"no ref\"\n                        : !flatListNode\n                            ? \"no flatlist node\"\n                            : \"invalid ref\";\n                    if (_this.props.debug)\n                        console.log(\"## can't measure \" + key + \" reason: \" + reason);\n                    _this.queue.push(function () { return _this.measureCell(key); });\n                    return resolve();\n                }\n            });\n        };\n        _this.keyExtractor = function (item, index) {\n            if (_this.props.keyExtractor)\n                return _this.props.keyExtractor(item, index);\n            else\n                throw new Error(\"You must provide a keyExtractor to DraggableFlatList\");\n        };\n        _this.onContainerLayout = function () {\n            var horizontal = _this.props.horizontal;\n            var containerRef = _this.containerRef.current;\n            if (containerRef) {\n                containerRef.getNode().measure(function (_x, _y, w, h) {\n                    _this.containerSize.setValue(horizontal ? w : h);\n                });\n            }\n        };\n        _this.onListContentSizeChange = function (w, h) {\n            _this.scrollViewSize.setValue(_this.props.horizontal ? w : h);\n            if (_this.props.onContentSizeChange)\n                _this.props.onContentSizeChange(w, h);\n        };\n        _this.targetScrollOffset = new Value(0);\n        _this.onAutoscrollComplete = function (params) {\n            _this.isAutoScrollInProgress.js = false;\n            if (_this.resolveAutoscroll)\n                _this.resolveAutoscroll(params);\n        };\n        _this.scrollToAsync = function (offset) {\n            return new Promise(function (resolve) {\n                var _a;\n                _this.resolveAutoscroll = resolve;\n                _this.targetScrollOffset.setValue(offset);\n                _this.isAutoScrollInProgress.native.setValue(1);\n                _this.isAutoScrollInProgress.js = true;\n                var flatlistRef = _this.flatlistRef.current;\n                if (flatlistRef) {\n                    var flatlistNode = \"scrollToOffset\" in flatlistRef\n                        ? flatlistRef\n                        : \"getNode\" in flatlistRef\n                            ? //@ts-ignore backwards compat\n                                flatlistRef.getNode()\n                            : null;\n                    (_a = flatlistNode === null || flatlistNode === void 0 ? void 0 : flatlistNode.scrollToOffset) === null || _a === void 0 ? void 0 : _a.call(flatlistNode, { offset: offset });\n                }\n            });\n        };\n        _this.getScrollTargetOffset = function (distFromTop, distFromBottom, scrollOffset, isScrolledUp, isScrolledDown) {\n            if (_this.isAutoScrollInProgress.js)\n                return -1;\n            var _a = _this.props, autoscrollThreshold = _a.autoscrollThreshold, autoscrollSpeed = _a.autoscrollSpeed;\n            var scrollUp = distFromTop < autoscrollThreshold;\n            var scrollDown = distFromBottom < autoscrollThreshold;\n            if (!(scrollUp || scrollDown) ||\n                (scrollUp && isScrolledUp) ||\n                (scrollDown && isScrolledDown))\n                return -1;\n            var distFromEdge = scrollUp ? distFromTop : distFromBottom;\n            var speedPct = 1 - distFromEdge / autoscrollThreshold;\n            // Android scroll speed seems much faster than ios\n            var speed = react_native_1.Platform.OS === \"ios\" ? autoscrollSpeed : autoscrollSpeed / 10;\n            var offset = speedPct * speed;\n            var targetOffset = scrollUp\n                ? Math.max(0, scrollOffset - offset)\n                : scrollOffset + offset;\n            return targetOffset;\n        };\n        // Ensure that only 1 call to autoscroll is active at a time\n        _this.autoscrollLooping = false;\n        _this.autoscroll = function (params) { return __awaiter(_this, void 0, void 0, function () {\n            var shouldScroll, curParams, distFromTop, distFromBottom, scrollOffset, isScrolledUp, isScrolledDown, targetOffset, scrollingUpAtTop, scrollingDownAtBottom;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.autoscrollLooping) {\n                            return [2 /*return*/];\n                        }\n                        this.autoscrollLooping = true;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, , 6, 7]);\n                        shouldScroll = true;\n                        curParams = params;\n                        _a.label = 2;\n                    case 2:\n                        if (!shouldScroll) return [3 /*break*/, 5];\n                        distFromTop = curParams[0], distFromBottom = curParams[1], scrollOffset = curParams[2], isScrolledUp = curParams[3], isScrolledDown = curParams[4];\n                        targetOffset = this.getScrollTargetOffset(distFromTop, distFromBottom, scrollOffset, !!isScrolledUp, !!isScrolledDown);\n                        scrollingUpAtTop = !!(isScrolledUp && targetOffset <= scrollOffset);\n                        scrollingDownAtBottom = !!(isScrolledDown && targetOffset >= scrollOffset);\n                        shouldScroll =\n                            targetOffset >= 0 &&\n                                this.isPressedIn.js &&\n                                !scrollingUpAtTop &&\n                                !scrollingDownAtBottom;\n                        if (!shouldScroll) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.scrollToAsync(targetOffset)];\n                    case 3:\n                        curParams = _a.sent();\n                        _a.label = 4;\n                    case 4: return [3 /*break*/, 2];\n                    case 5: return [3 /*break*/, 7];\n                    case 6:\n                        this.autoscrollLooping = false;\n                        return [7 /*endfinally*/];\n                    case 7: return [2 /*return*/];\n                }\n            });\n        }); };\n        _this.isAtTopEdge = lessOrEq(_this.distToTopEdge, _this.props.autoscrollThreshold);\n        _this.isAtBottomEdge = lessOrEq(_this.distToBottomEdge, _this.props.autoscrollThreshold);\n        _this.isAtEdge = or(_this.isAtBottomEdge, _this.isAtTopEdge);\n        _this.autoscrollParams = [\n            _this.distToTopEdge,\n            _this.distToBottomEdge,\n            _this.scrollOffset,\n            _this.isScrolledUp,\n            _this.isScrolledDown,\n        ];\n        _this.checkAutoscroll = cond(and(_this.isAtEdge, not(and(_this.isAtTopEdge, _this.isScrolledUp)), not(and(_this.isAtBottomEdge, _this.isScrolledDown)), eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), not(_this.isAutoScrollInProgress.native)), call(_this.autoscrollParams, _this.autoscroll));\n        _this.onScroll = event([\n            {\n                nativeEvent: function (_a) {\n                    var contentOffset = _a.contentOffset;\n                    return block([\n                        set(_this.scrollOffset, _this.props.horizontal ? contentOffset.x : contentOffset.y),\n                        cond(and(_this.isAutoScrollInProgress.native, or(\n                        // We've scrolled to where we want to be\n                        lessOrEq(abs(sub(_this.targetScrollOffset, _this.scrollOffset)), scrollPositionTolerance), \n                        // We're at the start, but still want to scroll farther up\n                        and(_this.isScrolledUp, lessOrEq(_this.targetScrollOffset, _this.scrollOffset)), \n                        // We're at the end, but still want to scroll further down\n                        and(_this.isScrolledDown, greaterOrEq(_this.targetScrollOffset, _this.scrollOffset)))), [\n                            // Finish scrolling\n                            set(_this.isAutoScrollInProgress.native, 0),\n                            call(_this.autoscrollParams, _this.onAutoscrollComplete),\n                        ]),\n                    ]);\n                },\n            },\n        ]);\n        _this.onGestureRelease = [\n            cond(_this.isHovering, [\n                set(_this.disabled, 1),\n                cond(defined(_this.hoverClock), [\n                    cond(clockRunning(_this.hoverClock), [stopClock(_this.hoverClock)]),\n                    set(_this.hoverAnimState.position, _this.hoverAnim),\n                    startClock(_this.hoverClock),\n                ]),\n                [\n                    call([_this.activeIndex], _this.onRelease),\n                    cond(not(_this.hasMoved), call([_this.activeIndex], _this.resetHoverState)),\n                ],\n            ], [call([_this.activeIndex], _this.resetHoverState), _this.resetTouchedCell]),\n        ];\n        _this.onPanStateChange = event([\n            {\n                nativeEvent: function (_a) {\n                    var state = _a.state, x = _a.x, y = _a.y;\n                    return cond(and(neq(state, _this.panGestureState), not(_this.disabled)), [\n                        cond(or(eq(state, react_native_gesture_handler_1.State.BEGAN), // Called on press in on Android, NOT on ios!\n                        // GestureState.BEGAN may be skipped on fast swipes\n                        and(eq(state, react_native_gesture_handler_1.State.ACTIVE), neq(_this.panGestureState, react_native_gesture_handler_1.State.BEGAN))), [\n                            set(_this.touchAbsolute, _this.props.horizontal ? x : y),\n                            set(_this.touchInit, _this.touchAbsolute),\n                        ]),\n                        cond(eq(state, react_native_gesture_handler_1.State.ACTIVE), [\n                            set(_this.activationDistance, sub(_this.props.horizontal ? x : y, _this.touchInit)),\n                            set(_this.touchAbsolute, _this.props.horizontal ? x : y),\n                        ]),\n                        cond(neq(_this.panGestureState, state), set(_this.panGestureState, state)),\n                        cond(or(eq(state, react_native_gesture_handler_1.State.END), eq(state, react_native_gesture_handler_1.State.CANCELLED), eq(state, react_native_gesture_handler_1.State.FAILED)), _this.onGestureRelease),\n                    ]);\n                },\n            },\n        ]);\n        _this.onPanGestureEvent = event([\n            {\n                nativeEvent: function (_a) {\n                    var x = _a.x, y = _a.y;\n                    return cond(and(_this.isHovering, eq(_this.panGestureState, react_native_gesture_handler_1.State.ACTIVE), not(_this.disabled)), [\n                        cond(not(_this.hasMoved), set(_this.hasMoved, 1)),\n                        [set(_this.touchAbsolute, _this.props.horizontal ? x : y)],\n                    ]);\n                },\n            },\n        ]);\n        _this.hoverComponentTranslate = cond(clockRunning(_this.hoverClock), _this.hoverAnimState.position, _this.hoverAnim);\n        _this.hoverComponentOpacity = and(_this.isHovering, neq(_this.panGestureState, react_native_gesture_handler_1.State.CANCELLED));\n        _this.renderHoverComponent = function () {\n            var _a;\n            var hoverComponent = _this.state.hoverComponent;\n            var horizontal = _this.props.horizontal;\n            return (react_1.default.createElement(react_native_reanimated_1.default.View, { style: [\n                    horizontal\n                        ? styles.hoverComponentHorizontal\n                        : styles.hoverComponentVertical,\n                    {\n                        opacity: _this.hoverComponentOpacity,\n                        transform: [\n                            (_a = {},\n                                _a[\"translate\" + (horizontal ? \"X\" : \"Y\")] = _this\n                                    .hoverComponentTranslate,\n                                _a),\n                            // We need the cast because the transform array usually accepts\n                            // only specific keys, and we dynamically generate the key\n                            // above\n                        ],\n                    },\n                ] }, hoverComponent));\n        };\n        _this.renderItem = function (_a) {\n            var item = _a.item, index = _a.index;\n            var key = _this.keyExtractor(item, index);\n            if (index !== _this.keyToIndex.get(key))\n                _this.keyToIndex.set(key, index);\n            var renderItem = _this.props.renderItem;\n            if (!_this.cellData.get(key))\n                _this.setCellData(key, index);\n            var onUnmount = (_this.cellData.get(key) || {\n                onUnmount: function () {\n                    if (_this.props.debug)\n                        console.log(\"## error, no cellData\");\n                },\n            }).onUnmount;\n            return (react_1.default.createElement(RowItem, { extraData: _this.props.extraData, itemKey: key, keyToIndex: _this.keyToIndex, renderItem: renderItem, item: item, drag: _this.drag, onUnmount: onUnmount }));\n        };\n        _this.renderOnPlaceholderIndexChange = function () { return (react_1.default.createElement(react_native_reanimated_1.default.Code, { dependencies: [] }, function () {\n            return block([\n                onChange(_this.spacerIndex, call([_this.spacerIndex], function (_a) {\n                    var spacerIndex = _a[0];\n                    return _this.props.onPlaceholderIndexChange(spacerIndex);\n                })),\n            ]);\n        })); };\n        _this.renderPlaceholder = function () {\n            var _a, _b;\n            var _c = _this.props, renderPlaceholder = _c.renderPlaceholder, horizontal = _c.horizontal;\n            var activeKey = _this.state.activeKey;\n            if (!activeKey || !renderPlaceholder)\n                return null;\n            var activeIndex = _this.keyToIndex.get(activeKey);\n            if (activeIndex === undefined)\n                return null;\n            var activeItem = _this.props.data[activeIndex];\n            var translateKey = horizontal ? \"translateX\" : \"translateY\";\n            var sizeKey = horizontal ? \"width\" : \"height\";\n            var style = __assign(__assign({}, react_native_1.StyleSheet.absoluteFillObject), (_a = {}, _a[sizeKey] = _this.activeCellSize, _a.transform = [\n                (_b = {}, _b[translateKey] = _this.placeholderPos, _b),\n            ], _a));\n            return (react_1.default.createElement(react_native_reanimated_1.default.View, { style: style }, renderPlaceholder({ item: activeItem, index: activeIndex })));\n        };\n        _this.CellRendererComponent = function (cellProps) {\n            var item = cellProps.item, index = cellProps.index, children = cellProps.children, onLayout = cellProps.onLayout;\n            var horizontal = _this.props.horizontal;\n            var activeKey = _this.state.activeKey;\n            var key = _this.keyExtractor(item, index);\n            if (!_this.cellData.get(key))\n                _this.setCellData(key, index);\n            var cellData = _this.cellData.get(key);\n            if (!cellData)\n                return null;\n            var style = cellData.style, onCellLayout = cellData.onLayout;\n            var ref = _this.cellRefs.get(key);\n            if (!ref) {\n                ref = react_1.default.createRef();\n                _this.cellRefs.set(key, ref);\n            }\n            var isActiveCell = activeKey === key;\n            return (react_1.default.createElement(react_native_reanimated_1.default.View, { onLayout: onLayout, style: style },\n                react_1.default.createElement(react_native_reanimated_1.default.View, { pointerEvents: activeKey ? \"none\" : \"auto\", style: {\n                        flexDirection: horizontal ? \"row\" : \"column\",\n                    } },\n                    react_1.default.createElement(react_native_reanimated_1.default.View, { ref: ref, onLayout: onCellLayout, style: isActiveCell ? { opacity: 0 } : undefined }, children))));\n        };\n        _this.onContainerTouchEnd = function () {\n            _this.isPressedIn.native.setValue(0);\n        };\n        var data = props.data, onRef = props.onRef;\n        data.forEach(function (item, index) {\n            var key = _this.keyExtractor(item, index);\n            _this.keyToIndex.set(key, index);\n        });\n        onRef && onRef(_this.flatlistRef);\n        return _this;\n    }\n    DraggableFlatList.getDerivedStateFromProps = function (props) {\n        return {\n            extraData: props.extraData,\n        };\n    };\n    DraggableFlatList.prototype.renderDebug = function () {\n        var _this = this;\n        return (react_1.default.createElement(react_native_reanimated_1.default.Code, { dependencies: [] }, function () {\n            return block([\n                onChange(_this.spacerIndex, debug(\"spacerIndex: \", _this.spacerIndex)),\n            ]);\n        }));\n    };\n    DraggableFlatList.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, dragHitSlop = _a.dragHitSlop, scrollEnabled = _a.scrollEnabled, horizontal = _a.horizontal, activationDistance = _a.activationDistance, onScrollOffsetChange = _a.onScrollOffsetChange, renderPlaceholder = _a.renderPlaceholder, onPlaceholderIndexChange = _a.onPlaceholderIndexChange, containerStyle = _a.containerStyle, simultaneousHandlers = _a.simultaneousHandlers;\n        var hoverComponent = this.state.hoverComponent;\n        var dynamicProps = {};\n        if (activationDistance) {\n            var activeOffset = [-activationDistance, activationDistance];\n            dynamicProps = horizontal\n                ? { activeOffsetX: activeOffset }\n                : { activeOffsetY: activeOffset };\n        }\n        return (react_1.default.createElement(react_native_gesture_handler_1.PanGestureHandler, __assign({ ref: this.panGestureHandlerRef, hitSlop: dragHitSlop, onGestureEvent: this.onPanGestureEvent, onHandlerStateChange: this.onPanStateChange, simultaneousHandlers: simultaneousHandlers }, dynamicProps),\n            react_1.default.createElement(react_native_reanimated_1.default.View, { style: [styles.flex, containerStyle], ref: this.containerRef, onLayout: this.onContainerLayout, onTouchEnd: this.onContainerTouchEnd },\n                !!onPlaceholderIndexChange && this.renderOnPlaceholderIndexChange(),\n                !!renderPlaceholder && this.renderPlaceholder(),\n                react_1.default.createElement(AnimatedFlatList, __assign({}, this.props, { CellRendererComponent: this.CellRendererComponent, ref: this.flatlistRef, onContentSizeChange: this.onListContentSizeChange, scrollEnabled: !hoverComponent && scrollEnabled, renderItem: this.renderItem, extraData: this.state, keyExtractor: this.keyExtractor, onScroll: this.onScroll, scrollEventThrottle: 1, simultaneousHandlers: simultaneousHandlers })),\n                !!hoverComponent && this.renderHoverComponent(),\n                react_1.default.createElement(react_native_reanimated_1.default.Code, { dependencies: [] }, function () {\n                    return block([\n                        onChange(_this.isPressedIn.native, cond(not(_this.isPressedIn.native), _this.onGestureRelease)),\n                        // This onChange handles autoscroll checking BUT it also ensures that\n                        // hover translation is continually evaluated. Removing it causes a flicker.\n                        onChange(_this.hoverComponentTranslate, _this.checkAutoscroll),\n                        cond(clockRunning(_this.hoverClock), [\n                            spring(_this.hoverClock, _this.hoverAnimState, _this.hoverAnimConfig),\n                            cond(eq(_this.hoverAnimState.finished, 1), [\n                                _this.resetTouchedCell,\n                                stopClock(_this.hoverClock),\n                                call(_this.moveEndParams, _this.onDragEnd),\n                                set(_this.hasMoved, 0),\n                            ]),\n                        ]),\n                    ]);\n                }),\n                onScrollOffsetChange && (react_1.default.createElement(react_native_reanimated_1.default.Code, { dependencies: [] }, function () {\n                    return onChange(_this.scrollOffset, call([_this.scrollOffset], function (_a) {\n                        var offset = _a[0];\n                        return onScrollOffsetChange(offset);\n                    }));\n                })),\n                !!this.props.debug && this.renderDebug())));\n    };\n    DraggableFlatList.defaultProps = defaultProps;\n    return DraggableFlatList;\n}(react_1.default.Component));\nexports.default = DraggableFlatList;\nvar RowItem = /** @class */ (function (_super) {\n    __extends(RowItem, _super);\n    function RowItem() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.drag = function () {\n            var _a = _this.props, drag = _a.drag, renderItem = _a.renderItem, item = _a.item, keyToIndex = _a.keyToIndex, itemKey = _a.itemKey, debug = _a.debug;\n            var hoverComponent = renderItem({\n                isActive: true,\n                item: item,\n                index: keyToIndex.get(itemKey),\n                drag: function () {\n                    if (debug)\n                        console.log(\"## attempt to call drag() on hovering component\");\n                },\n            });\n            drag(hoverComponent, itemKey);\n        };\n        return _this;\n    }\n    RowItem.prototype.componentWillUnmount = function () {\n        this.props.onUnmount();\n    };\n    RowItem.prototype.render = function () {\n        var _a = this.props, renderItem = _a.renderItem, item = _a.item, keyToIndex = _a.keyToIndex, itemKey = _a.itemKey;\n        return renderItem({\n            isActive: false,\n            item: item,\n            index: keyToIndex.get(itemKey),\n            drag: this.drag,\n        });\n    };\n    return RowItem;\n}(react_1.default.PureComponent));\nvar styles = react_native_1.StyleSheet.create({\n    flex: {\n        flex: 1,\n    },\n    hoverComponentVertical: {\n        position: \"absolute\",\n        left: 0,\n        right: 0,\n    },\n    hoverComponentHorizontal: {\n        position: \"absolute\",\n        bottom: 0,\n        top: 0,\n    },\n});\n"]},"metadata":{},"sourceType":"script"}